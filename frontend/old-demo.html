<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Azure Landing Zone Agent — Demo</title>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-top: 12px; }
        select, button { padding: 6px; margin-top: 6px; }
        pre { background: #f6f6f6; padding: 10px; }
        #diagram { border: 1px solid #ccc; padding: 10px; min-height: 200px; }
    </style>
</head>
<body>
    <h2>Azure Landing Zone Agent — Demo</h2>

    <label>Business Objective:
        <select id="business">
            <option>Cost</option>
            <option>Agility</option>
            <option>Innovation</option>
            <option>Scalability</option>
        </select>
    </label>

    <label>Network Model:
        <select id="network">
            <option>Hub-Spoke</option>
            <option>Mesh</option>
            <option>Virtual WAN</option>
        </select>
    </label>

    <label>Workload:
        <select id="workload">
            <option>AKS</option>
            <option>App Services</option>
            <option>VMs</option>
            <option>Databases</option>
            <option>SAP</option>
            <option>AI/ML</option>
        </select>
    </label>

    <label>Monitoring:
        <select id="monitoring">
            <option>Azure Monitor</option>
            <option>Log Analytics</option>
            <option>Prometheus</option>
            <option>Grafana</option>
        </select>
    </label>

    <label>Security:
        <select id="security">
            <option>Zero Trust</option>
            <option>SIEM/SOAR</option>
        </select>
    </label>

    <br /><br />
    <button onclick="generateMermaid()">Generate (Mermaid)</button>
    <button onclick="generateDrawio()">Generate (Azure Icons - Draw.io)</button>
    <button onclick="generatePythonDiagram()">Generate (Python Diagram - PNG)</button>

    <h3>Raw Mermaid Syntax (debug)</h3>
    <pre id="mermaidSyntax"></pre>

    <h3>Mermaid Diagram</h3>
    <div id="diagram"></div>

    <h3>Azure-Style Diagram (Draw.io)</h3>
    <div id="diagramContainer"></div>

    <h3>Python Generated Diagram (PNG)</h3>
    <div id="pythonDiagramContainer"></div>

    <script src="viewer.min.js"></script>

    <script>
        async function generateMermaid() {
            const payload = collectInputs();
            try {
                const res = await fetch("http://127.0.0.1:8001/generate-diagram", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });
                const data = await res.json();
                document.getElementById("mermaidSyntax").textContent = data.mermaid || "";
                const diagramDiv = document.getElementById("diagram");
                diagramDiv.innerHTML = "";
                const uniqueId = "graph-" + Date.now();
                mermaid.render(uniqueId, data.mermaid.trim(), (svgCode) => {
                    diagramDiv.innerHTML = svgCode;
                });
                document.getElementById("tsd").textContent = data.tsd || "";
                document.getElementById("hld").textContent = data.hld || "";
                document.getElementById("lld").textContent = data.lld || "";
            } catch (err) {
                alert("❌ Error (Mermaid): " + err);
                console.error(err);
            }
        }

        async function generateDrawio() {
            const payload = collectInputs();
            try {
                const res = await fetch("http://127.0.0.1:8001/generate-drawio", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });
                const xml = await res.text();
                const diagramContainer = document.getElementById('diagramContainer');
                diagramContainer.innerHTML = ''; // Clear previous diagram
                const viewer = new mxGraphViewer(diagramContainer);
                viewer.fit();
                viewer.setDiagram(xml);
            } catch (err) {
                alert("❌ Error (Draw.io): " + err);
                console.error(err);
            }
        }

        async function generatePythonDiagram() {
            const payload = collectInputs();
            try {
                const res = await fetch("http://127.0.0.1:8001/generate-python-diagram", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });
                const blob = await res.blob();
                const imageUrl = URL.createObjectURL(blob);
                const pythonDiagramContainer = document.getElementById('pythonDiagramContainer');
                pythonDiagramContainer.innerHTML = `<img src="${imageUrl}" alt="Python Generated Diagram" style="max-width: 100%; height: auto; border: 1px solid #ccc; border-radius: 8px;">`;
            } catch (err) {
                alert("❌ Error (Python Diagram): " + err);
                console.error(err);
            }
        }

        function collectInputs() {
            return {
                business_objective: document.getElementById("business").value,
                network_model: document.getElementById("network").value,
                workload: document.getElementById("workload").value,
                monitoring: document.getElementById("monitoring").value,
                security_posture: document.getElementById("security").value,
            };
        }
    </script>

    <h3>TSD</h3>
    <pre id="tsd"></pre>

    <h3>HLD</h3>
    <pre id="hld"></pre>

    <h3>LLD</h3>
    <pre id="lld"></pre>
</body>
</html>
