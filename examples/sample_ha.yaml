# Sample HA Multi-Region Architecture Manifest
# Demonstrates Web App + Queue + Functions + Redis + Table + (optional) VM

project_name: "Sample HA Application"
environment: "prod"

# Geographic distribution
regions:
  - "East US 2"
  - "West US 2"

# High availability configuration
ha_mode: "active-active"

# Edge services
edge_services:
  - "front_door"

# Identity services  
identity_services:
  - "entra_id"

# Core application services
services:
  # Web application tier
  - kind: "web_app"
    name: "Frontend Web App"
    properties:
      runtime: ".NET 8"
      tier: "P1v2"
      custom_domain: true
      ssl_certificate: true

  # API tier
  - kind: "function_app" 
    name: "API Functions"
    properties:
      runtime: ".NET 8"
      hosting_plan: "Premium"

  # Caching layer
  - kind: "redis"
    name: "App Cache"
    properties:
      tier: "Standard"
      size: "C1"
      vnet_integration: false

  # Data storage
  - kind: "storage_account"
    name: "App Storage"
    properties:
      performance: "Standard"
      replication: "GRS"
      services: ["blob", "queue", "table"]

  # Database
  - kind: "sql_database"
    name: "App Database"
    properties:
      tier: "General Purpose"
      size: "GP_Gen5_2"
      geo_replication: true

  # Optional VM for legacy processing
  - kind: "vm"
    name: "Processing VM"
    properties:
      os: "windows"
      size: "Standard_D2s_v3"
      public_access: false
      managed_disks: true

  # Application Gateway for load balancing
  - kind: "application_gateway"
    name: "App Gateway"
    properties:
      sku: "WAF_v2"
      waf_protection: true
      instances: 2

  # Monitoring and observability
  - kind: "log_analytics"
    name: "Central Logging"
    properties:
      retention: 90
      pricing_tier: "PerGB2018"

  - kind: "application_insights"
    name: "App Monitoring"
    properties:
      application_type: "web"
      ingestion_method: "workspace-based"

  # Security
  - kind: "key_vault"
    name: "App Secrets"
    properties:
      sku: "Standard"
      hsm_protection: false

# Networking defaults
networking:
  address_space: "10.0.0.0/16"
  subnet_prefix: "10.0.1.0/24"
  enable_bastion: false
  enable_nat_gateway: false